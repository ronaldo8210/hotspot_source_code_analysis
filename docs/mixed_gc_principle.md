Mixed GC（混合回收）分为4个阶段：

- 初始标记阶段

- 并发标记阶段

- 再标记阶段

- 垃圾回收阶段

主要工作在并发标记阶段。

在并发标记阶段，因为应用还在运行，所以可能会有引用变更，包括现有引用指向别的对象，或者删除了一个引用，或者创建了一个新的对象等。总结就是：引用的新建、删除、更新三种情况。

并发标记阶段，引用的变化有5种：

- new一个对象，新对象被某个老对象引用。新对象直接作为黑色对象；

- 一个对象，被A对象引用时，又被B对象引用，这种情况不会出现漏标；

- 一个灰对象引用了A，但不再引用了，原引用置为null，原来的映射关系（引用A）要被SATB记录下来，但造成了浮动垃圾，A下一次才会被认为是白对象；

- 一个灰对象引用了A，但不再引用了，A改为被另一个灰对象引用，SATB可防止漏标；

- 一个灰对象引用了A，但不再引用了，A改为被另一个黑对象引用，SATB可防止漏标。

JVM使用三色标记：

- 将本身已被标记、且所有直接引用到的对象也都被标记的对象视作黑标对象；

- 将本身已被标记、但所有直接引用到的对象未被标记完的对象视作灰标对象；

- 本身未标记的对象视作白标对象。

三色标记的具体算法：

- 在本轮标记期间新生成的对象，全部作为黑色对象处理（可能要根据SATB指针的位置判断），本轮不会被回收；

- 对于引用变化造成的错标，本轮可以忍受；

- 对于漏标，解决方式是，在并发标记过程中，如果Java应用线程更改了一个灰色对象的引用，则原来的引用对象要被记录下来，原理就是SATB，意思就是尽量维持并发标记开始时刻的整体内存的原有样子，即快照。
